# Subscription Management API

REST API для управления подписками пользователей. Сервис позволяет создавать, читать, обновлять и удалять подписки, а также рассчитывать их общую стоимость.

---

## Основной функционал

- **CRUDL операции с подписками** — создание, чтение, обновление и удаление подписок, подсчет цены по фильрам.
- **Полный E2E тестовый сценарий** — скрипт для тестирования всего жизненного цикла подписок
- **Простая развертываемость**: готовые Docker-конфигурации для быстрого запуска
- **Миграции**: управление схемой БД через миграции с версионированием

---

### Инфраструктура

- **Docker** — контейнеризация всех сервисов
- **Docker Compose** — оркестрация: Go-бэкенд, PostgreSQL, Caddy, Go-миграции через goose

---

## Архитектура

- **Архитектурный стиль** — взаимодействие через REST API
- **Модульная структура**: `handlers`, `services`, `storage` — разделение ответственности для удобства тестирования, поддержки и понимания кода
- **Долговременное хранение**: PostgreSQL с индексами
- **Caddy**: выступает обратным прокси с JSON-логированием, сжатием ответов и обработкой ошибок.

---

# API

| Эндпоинт                          | Метод  | Описание                                      |
|-----------------------------------|--------|-----------------------------------------------|
| `/api/subs/create`                | POST   | Создание новой подписки                       |
| `/api/get-subs/param`             | POST   | Расчет общей стоимости подписок по параметрам |
| `/api/get-subs/user-id/one`       | POST   | Получение конкретной подписки по её ID        |
| `/api/get-subs/user-id/all`       | POST   | Получение всех подписок пользователя          |
| `/api/subs/update`                | PUT    | Обновление информации о подписке              |
| `/api/subs/delete`                | DELETE | Удаление подписки                             |

----

## Запуск
```bash
cp .env.example .env
docker compose up --build 
```
Миграции накатываются автоматически.

----

## Тестирование
```bash
make e2e 

make test 
```

----

## Сетевые логи
```bash
docker logs -f test-task-caddy-1
```
----

## Миграции
```bash
# запускаем постгрес
docker compose up postgres -d

# Применить все миграции
docker compose run --rm migrate up

# Посмотреть статус
docker compose run --rm migrate status

# Откатить последнюю миграцию
docker compose run --rm migrate down

# Откатить до конкретной версии (например, 1)
docker compose run --rm migrate down 1

# Сбросить всё (down всех миграций)
docker compose run --rm migrate reset

# Узнать текущую версию
docker compose run --rm migrate version

```
